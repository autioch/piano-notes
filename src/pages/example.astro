---
import type { Bar } from "@/types/piano";
import Layout from "@/components/Layout.astro";
import SheetMusic from "@/components/SheetMusic.astro";
import { ALL_DURATIONS, ALL_FINISHES, ALL_PITCHES } from "@/consts";
import A4Paper from "@components/atoms/A4Paper.astro";

function chunkArray<T>(array: T[], chunkSize: number): T[][] {
  const chunks: T[][] = [];
  for (let i = 0; i < array.length; i += chunkSize) {
    chunks.push(array.slice(i, i + chunkSize));
  }
  return chunks;
}

const pitchBars = chunkArray(ALL_PITCHES, 7).map<Bar>((pitchesChunk, i) => ({
  notes: pitchesChunk.map((pitch) => ({
    pitch,
    duration: 0.0625,
  })),
  type: ALL_FINISHES[i % ALL_FINISHES.length],
}));

const durationBars = chunkArray(ALL_DURATIONS, 7).map<Bar>(
  (durationsChunk, i) => ({
    notes: durationsChunk.map((duration) => ({
      pitch: "F4",
      duration,
    })),
    type: ALL_FINISHES[i % ALL_FINISHES.length],
  })
);
---

<Layout>
  <A4Paper>
    <SheetMusic
      sheetMusic={{
        bars: [...durationBars, ...pitchBars],
        composer: "Example",
        key: "violin",
        meter: [4, 4],
        title: "Example",
      }}
    />
  </A4Paper>
</Layout>
