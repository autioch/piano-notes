---
import notes from "../notes/wlazl-kotek-na-plotek.json";
import SerializedPianoNotes from "../components/SerializedPianoNotes.astro";
import ScoreSVG from "../components/svg/ScoreSVG.astro";
import { safeParseSerializedPianoNotes } from "../types/piano.schema";

const parsed = safeParseSerializedPianoNotes(notes);
let payload = null;
let error = null;
if (parsed.success) {
  payload = parsed.data;
} else {
  error = parsed.error;
}
---

<head>
  <style>
    :root {
      color-scheme: light dark;
    }
    main {
      font-family:
        system-ui,
        -apple-system,
        Segoe UI,
        Roboto,
        "Helvetica Neue",
        Arial;
      padding: 16px;
    }
    .controls {
      margin-bottom: 12px;
    }
    .print-area {
      border: 1px solid #eee;
      display: inline-block;
    }

    /* Print rules: produce a single A4 page with the SVG sized to A4 */
    @page {
      size: A4;
      margin: 10mm;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .print-area,
      .print-area * {
        visibility: visible;
      }
      .print-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 210mm;
        height: 297mm;
      }
      /* ensure SVG scales to fill the page box */
      .print-area svg {
        width: 210mm;
        height: 297mm;
      }
    }
  </style>
</head>

<main>
  <h1>Wlazł kotek na płotek</h1>

  <div class="controls">
    <button type="button" on:click="window.print()">Print A4</button>
  </div>

  {
    error ? (
      <section>
        <h2>Validation Error</h2>
        <pre>{JSON.stringify(error, null, 2)}</pre>
      </section>
    ) : (
      <>
        <section>
          <h2>Serialized view</h2>
          <SerializedPianoNotes payload={payload} />
        </section>

        <section style="margin-top:20px;">
          <h2>Printable A4 Score</h2>
          <div class="print-area">
            <ScoreSVG score={payload.score} />
          </div>
        </section>
      </>
    )
  }
</main>
